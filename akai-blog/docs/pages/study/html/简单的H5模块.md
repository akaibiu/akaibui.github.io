# :sheep: ç®€å•çš„H5æ¨¡å—



>ä»¥ä¸‹æ˜¯æˆ‘åœ¨å·¥ä½œä¸­åšçš„ä¸€ä¸ªç®€å•çš„H5æ¨¡å—ï¼Œä¸€èµ·çœ‹çœ‹å§....



```
<!DOCTYPE html>
<html>

<head>
	<meta name="viewport"
		content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no, viewport-fit=cover" />
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ä¼—æˆé‘«å¯Œ</title>
</head>

<body>
	<div id="main">
		<header>
			å¾®ä¿¡æ”¯ä»˜
		</header>
		<main>
			<div class="iptBox">
				<input type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„å……å€¼å·ç !" id="ipt">
				<div class="info">
					<span class="errTip"></span>
				</div>
			</div>
			<div class="pro" id="qrcode" ref="qrcode"></div>
			<div class="check">å……å€¼ä»·æ ¼: <span>10.00</span>å…ƒ</div>
		</main>
		<footer>
			<button id="payBtn">ç”Ÿæˆæ”¯ä»˜ç </button>
		</footer>
	</div>
	<script src="https://cdn.bootcdn.net/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.19.0/js/md5.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
	<script>
		// è®¾ç½®å…¨å±€å»¶è¿Ÿè°ƒç”¨æ—¶é•¿
		const waitDuration = 500;
		// è¯·æ±‚åœ°å€baseUrl
		const baseUrl = "http://192.168.9.34:8001";
		// è®¾ç½®AESåŠ å¯†key
		const aesKey = "wRdSzczXttHFtXyC";
		// è®¾ç½®appSecret
		const appSecret = "6cd8132a04df9592bf8fadca6061d939";
		// è®¾ç½®appid(æ”¯ä»˜)
		const payAppId = "9t3f2twrcpl";
		// è®¾ç½®versionç‰ˆæœ¬
		const version = "v1.0";
		// è®¾ç½®äºŒç»´ç ç”Ÿæˆé“¾æ¥
		var codeUrl;

		// appid=23raqkwr9ll
		// appsecret=f8d81572105cb719bb1a1ecfd7fed244
		// aeskey=eKJTNaCswmaikbZQ

		// è·å–domèŠ‚ç‚¹,ä¸ºæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶(åŠ å…¥èŠ‚æµåŠŸèƒ½å‡½æ•°)
		var payBtn = document.querySelector('#payBtn');
		var telPhoneVal = document.querySelector('#ipt');
		var errTip = document.querySelector('.errTip');
		var qrcodeBox = document.getElementById('qrcode');

		let pp = document.createElement('p');
		pp.innerHTML = "æ”¯ä»˜äºŒç»´ç å±•ç¤ºçª—å£";
		document.querySelector('#qrcode').appendChild(pp);

		// å®šä¹‰ä¸¤ä¸ªç¼“å­˜å€¼(å……å€¼è´¦å·)
		var firstLen = 0;
		var lastLen = 0;
		var reg = /^1(3|4|5|7|8)\d{9}$/;

		// æ”¯ä»˜æŒ‰é’®è§¦å‘ç‚¹å‡»äº‹ä»¶
		payBtn.addEventListener("click", clickFn(clickEvent, waitDuration));

		// èŠ‚æµåŠŸèƒ½å‡½æ•°,é˜²æ­¢ç”¨æˆ·å¤šæ¬¡è§¦å‘
		function clickFn(fn, delay) {
			let timer;
			return function () { // è¿™é‡Œæ˜¯æ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶è°ƒç”¨è¯¥åŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥è¯¥åŒ¿åå‡½æ•°æŒ‡å‘fnçš„DOMèŠ‚ç‚¹
				if (timer) {
					return;
				}
				let that = this;
				let arg = arguments;
				timer = setTimeout(function () {
					fn.apply(that, arg);
					timer = null;
				}, delay)
			}
		};

		// æ”¯ä»˜å‡½æ•°,ä»¥ä¸‹ä¸ºæ”¯ä»˜ä¸šåŠ¡åŠŸèƒ½ä»£ç 
		function clickEvent() {
			// !!! å†ç‚¹å‡»æ”¯ä»˜çš„æ—¶å€™åˆ é™¤#qrcodeä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹
			if (qrcodeBox.childNodes) {
				for (var i = qrcodeBox.childNodes.length - 1; i >= 0; i--) {
					qrcodeBox.removeChild(qrcodeBox.childNodes[i]);
				}
			};
			qrcodeBox.style.border="1px solid #007aff";
			// è¯·æ±‚ä¹‹å‰åˆ›å»ºèŠ‚ç‚¹å‘ŠçŸ¥ç”¨æˆ·äºŒç»´ç æ­£åœ¨åŠ è½½
			let pp = document.createElement('p');
			pp.innerHTML = "æ”¯ä»˜äºŒç»´ç æ­£åœ¨ç”Ÿæˆä¸­...";
			document.querySelector('#qrcode').appendChild(pp);
			// è®¾ç½®æ”¯ä»˜å‚æ•°
			const data = {
				openId: Math.random().toString(36).substr(2),
				merPayOrderId:Math.random().toString(36).substr(2),
				// merPayOrderId: '2423hf2434l3lfsdk',
				amount: 1,
				desc: "æµ‹è¯•æ”¯ä»˜"
			};

			// è®¾ç½®å‚æ•°åŠ å¯†
			var encrypt = CryptoJS.AES.encrypt(JSON.stringify(data), CryptoJS.enc.Utf8.parse(aesKey), {
				mode: CryptoJS.mode.ECB,
				padding: CryptoJS.pad.Pkcs7
			}).toString();

			// è®¾ç½®å‚æ•°è§£å¯† 
			var decrypt = CryptoJS.AES.decrypt(encrypt, CryptoJS.enc.Utf8.parse(aesKey), {
				mode: CryptoJS.mode.ECB,
				padding: CryptoJS.pad.Pkcs7
			}).toString(CryptoJS.enc.Utf8);

			// è®¾ç½®è¯·æ±‚å‚æ•°(è·å–å¾®ä¿¡æ”¯ä»˜äºŒç»´ç )
			const postOBj = {
				timestamp: new Date().valueOf(),
				edata: encrypt,
				sign: md5(JSON.stringify(data) + (new Date().valueOf()) + appSecret),
				appid: payAppId,
				version: version
			};

			// åŸç”Ÿè¯·æ±‚è·¨åŸŸ!!!!!!!!!!! this question comes from back-end;
			$.ajax({
				url: "http://192.168.9.34:8001/api/pay",
				type: "POST",
				dataType: "json",
				headers: {
					"content-type": 'application/json'
				},
				contentType: 'application/json',
				data: JSON.stringify(postOBj),
				success: function (res) {
					console.log(res, 'å“åº”æ•°æ®');
					if (res.code == 10) {
						setTimeout(() => {
							if (qrcodeBox.childNodes) {
								for (var i = qrcodeBox.childNodes.length - 1; i >= 0; i--) {
									qrcodeBox.removeChild(qrcodeBox.childNodes[i]);
								}
							};
							qrcodeBox.style.border="1px solid transparent";
							// new QRCode(document.getElementById("codeBox"), res.data.QrcodeUrl); // è®¾ç½®è¦ç”ŸæˆäºŒç»´ç çš„é“¾æ¥(ä¾¿æ·å¼ç”Ÿæˆæ— æ³•è®¾ç½®å®½é«˜)
							var qrcode = new QRCode('qrcode', {
								text: res.data.QrcodeUrl ? res.data.QrcodeUrl : '',
								width: 256,
								height: 256,
								colorDark: '#000000',
								colorLight: '#ffffff',
								correctLevel: QRCode.CorrectLevel.Q
							});
							qrcode.makeCode();
						}, 1000);
					} else {
						setTimeout(() => {
							if (qrcodeBox.childNodes) {
								for (var i = qrcodeBox.childNodes.length - 1; i >= 0; i--) {
									qrcodeBox.removeChild(qrcodeBox.childNodes[i]);
								}
							};
							let pp = document.createElement('p');
							pp.innerHTML = "æ”¯ä»˜ç ç”Ÿæˆå¤±è´¥,è¯·é‡æ–°æ”¯ä»˜!";
							document.querySelector('#qrcode').appendChild(pp);
						}, 1000);
					}
				},
				error: function (err) {
					console.log(err);
				}
			});
		};

		// æ‰‹æœºå·éªŒè¯
		telPhoneVal.oninput = function () {
			telPhoneVal.value = telPhoneVal.value.substr(0, 13); //åªå…è®¸è¾“å…¥11ä½+2ä¸ªç©ºæ ¼
			//ç”¨æˆ·è¾“å…¥æ»¡11ä½å¼€å§‹éªŒè¯
			if (telPhoneVal.value.length == 13) {
				//å°†æ•°æ®å»æ‰ç©ºæ ¼åéªŒè¯
				if (!reg.test(telPhoneVal.value.replace(/\s/g, ''))) {
					errTip.innerHTML = '*' + ' ' + 'æ‚¨è¾“å…¥çš„æ‰‹æœºè´¦å·æœ‰è¯¯,è¯·é‡æ–°è¾“å…¥'
				} else {
					errTip.innerHTML = ''
				}
			} else {
				errTip.innerHTML = ''
			}
		};

		// æ‰‹æœºå·å››ä½åˆ†å‰²
		telPhoneVal.onfocus = function () {
			timer = setInterval(function () {
				lastLen = telPhoneVal.value.length;
				if (lastLen > firstLen) {
					firstLen = telPhoneVal.value.length;
					if (lastLen === 4 || lastLen === 9) {
						var temp1 = telPhoneVal.value.substr(0, telPhoneVal.value.length - 1);
						var temp2 = telPhoneVal.value.substr(telPhoneVal.value.length - 1);
						telPhoneVal.value = temp1 + ' ' + temp2;
					}
				} else if (lastLen <= firstLen) {
					if (lastLen === 4 || lastLen === 9) {
						telPhoneVal.value = telPhoneVal.value.substr(0, telPhoneVal.value.length - 1);
					}
					firstLen = telPhoneVal.value.length;
				}
			}, 10); //å¦‚æœæ‰‹æœºå‡ºç°å¡é¡¿ï¼Œå¯é€‚å½“æŠŠå®šæ—¶å™¨æ—¶é—´åŠ å¤§
		};
	</script>
	<style>
		* {
			padding: 0;
			margin: 0;
		}

		body,
		html {
			width: 100%;
			height: 100%;
		}

		#main {
			width: 100%;
			height: 100%;
			background-color: #f2f2f2;
			display: flex;
			justify-content: space-between;
			flex-wrap: nowrap;
			flex-direction: column;
		}

		header {
			height: 30px;
			width: 100%;
			background-color: #5298e4;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 16px;
			font-family: 'Courier New', Courier, monospace;
			color: #fff;
			font-weight: bolder;
			letter-spacing: 1px;
		}

		main {
			flex: 1;
			width: 100%;
			height: 100%;
			overflow-y: scroll;
			background: #fff;
		}

		.iptBox {
			display: flex;
			height: 20%;
			width: 100%;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			padding: 5px 0px;
			box-sizing: border-box;
		}

		.iptBox input {
			display: inline;
			height: 50px;
			width: 90%;
			outline: none;
			border: none;
			font-size: 26px;
			font-weight: bolder;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			border-radius: none !important;
		}

		.info {
			width: 90%;
			margin: 0 auto;
			border-top: 1px solid #87aacf;
			height: 40px;
			margin-top: 5px;
			color: #f55c64;
			font-size: 13px;
			padding-top: 18px;
		}

		.pro {
			width: 256px;
			margin: 0 auto;
			margin-top: 15px;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 256px;
			border: 1px solid #007aff;
		}

		#qrcode>>>canvas {
			width: 250px !important;
			height: 250px !important;
		}

		#qrcode>>>img {
			width: 250px !important;
			height: 250px !important;
		}

		#qrcode p {
			font-size: 18px;
			color: #666;
			font-family: 'æ¥·ä½“';
			font-weight: 600;
		}

		.check {
			padding: 10px 5%;
			box-sizing: border-box;
			font-size: 16px;
			color: #333;
			font-family: 'æ¥·ä½“';
			margin-top: 30px;
		}

		.check span {
			font-size: 22px;
			color: #007aff;
		}

		footer {
			width: 100%;
			background-color: rgba(255, 255, 255, 0.4);
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 15px 0px 24px 0px;
			box-sizing: border-box;
		}

		button {
			width: 160px;
			line-height: 38px;
			text-align: center;
			font-weight: bold;
			color: #fff;
			text-shadow: 1px 1px 1px #333;
			border-radius: 5px;
			position: relative;
			overflow: hidden;
			border: 1px solid #007aff;
			box-shadow: 0 1px 2px #388ae2 inset, 0 -1px 0 #498fda inset, 0 -2px 3px #b9ecc4 inset;
			background: -webkit-linear-gradient(top, #2880dd, #6289b3);
			background: -moz-linear-gradient(top, #2b85e6, #2680e0);
			background: linear-gradient(top, #3987db, #438ddb);
		}

		button:hover {
			background: -webkit-linear-gradient(top, #40e048, #2fcc7d);
			background: -moz-linear-gradient(top, #40e048, #2fcc7d);
			background: linear-gradient(top, #40e048, #2fcc7d);
		}

		input::-webkit-input-placeholder {
			/* WebKit browsers*/
			color: #ccc;
			font-size: 14px;
			letter-spacing: 1px;
			display: table-cell;
			vertical-align: top;
			font-style: oblique;
			padding-left: 2px;
			font-family: 'æ¥·ä½“';
		}

		input:-moz-input-placeholder {
			/* Mozilla Firefox 4 to 18*/
			color: #ccc;
			font-size: 14px;
			letter-spacing: 1px;
			display: table-cell;
			vertical-align: top;
			font-style: oblique;
			font-family: 'æ¥·ä½“';
		}

		input::-moz-input-placeholder {
			/* Mozilla Firefox 19+*/
			color: #ccc;
			font-size: 14px;
			letter-spacing: 1px;
			display: table-cell;
			vertical-align: top;
			font-style: oblique;
			font-family: 'æ¥·ä½“';
		}

		input:-ms-input-placeholder {
			/* Internet Explorer 10+*/
			color: #ccc;
			letter-spacing: 1px;
			font-size: 14px;
			display: table-cell;
			vertical-align: top;
			font-style: oblique;
			font-family: 'æ¥·ä½“';
		}
	</style>
</body>

</html>

```

<font color="#dd00dd">ä»¥ä¸Šä»…åšå­¦ä¹ å‚è€ƒ</font><br />

![alt ç¤ºä¾‹å›¾ç‰‡](/img/study/html/ç®€å•çš„H5æ¨¡å—/demo.jpg)




* å¥½äº†ï¼Œä»¥ä¸Šçš„æ€»ç»“å°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œå¦‚æœ`æœ‰ç–‘é—®å¯ä»¥ä¸é—®`ä¹Ÿå¯ä»¥è”ç³»ä½œè€…ã€‚å’±ä»¬ä¸‹æœŸå†è§! Good bye! ğŸŒ¸